<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>基础的片元着色器技巧 | mikialex</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="整理一些通用的非常非常基础的片元着色器技巧。从来没有接触过片元着色器的朋友可以去看看thebookofshaders这个网站，非常不错//。顺便，它有一个交互的编辑器日常可以玩玩。 http://editor.thebookofshaders.com/SLWRZ/ (maybe需要科学上网). 。随机性一般来说shader里高效的生成随机数，这个随机性一般来自对一个超高频的函数进行采样。创造一个超"><meta property="og:type" content="article"><meta property="og:title" content="基础的片元着色器技巧"><meta property="og:url" content="http://mikialex.github.io/2018/11/06/simple-frag-shader/index.html"><meta property="og:site_name" content="mikialex"><meta property="og:description" content="整理一些通用的非常非常基础的片元着色器技巧。从来没有接触过片元着色器的朋友可以去看看thebookofshaders这个网站，非常不错//。顺便，它有一个交互的编辑器日常可以玩玩。 http://editor.thebookofshaders.com/SLWRZ/ (maybe需要科学上网). 。随机性一般来说shader里高效的生成随机数，这个随机性一般来自对一个超高频的函数进行采样。创造一个超"><meta property="og:locale" content="default"><meta property="og:updated_time" content="2020-08-23T07:00:50.629Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="基础的片元着色器技巧"><meta name="twitter:description" content="整理一些通用的非常非常基础的片元着色器技巧。从来没有接触过片元着色器的朋友可以去看看thebookofshaders这个网站，非常不错//。顺便，它有一个交互的编辑器日常可以玩玩。 http://editor.thebookofshaders.com/SLWRZ/ (maybe需要科学上网). 。随机性一般来说shader里高效的生成随机数，这个随机性一般来自对一个超高频的函数进行采样。创造一个超"><link rel="icon" href="/favicon.png"><link href="https://fonts.googleapis.com/css?family=Crimson+Text:400,700|Inconsolata|Oswald" rel="stylesheet"><link rel="stylesheet" href="/icomoon/style.css"><link rel="stylesheet" href="/style.css"></head><body><div class="site-wrapper is_post_page"><div id="loading-bar-wrapper"><div id="loading-bar"></div></div><script>document.getElementById("loading-bar").style.width="20%"</script><header id="header" class="site-header clearfix"><a class="logo square clearfix" href="/"><span class="b">A</span> <span class="b">R</span> <span class="b">T</span> <span class="w">I</span> <span class="w">F</span> <span class="b">A</span> <span class="b">C</span> <span class="b">T</span> </a><a class="me square site-nav-switch clearfix"><span class="b"><span class="icon icon-menu"></span></span></a></header><script>document.getElementById("loading-bar").style.width="40%"</script><main id="main" class="clearfix"><article id="post-simple-frag-shader" class="article white-box article-type-post" itemscope itemprop="blogPost"><header class="article-header"><h1 class="article-title" itemprop="name">基础的片元着色器技巧</h1><div class="article-meta">Posted on <time class="article-time" datetime="2018-11-05T16:00:00.000Z" itemprop="datePublished">Nov 6, 2018</time></div></header><div class="article-entry" itemprop="articleBody"><p>整理一些通用的非常非常基础的片元着色器技巧。</p><p>从来没有接触过片元着色器的朋友可以去看看thebookofshaders这个网站，非常不错//。顺便，它有一个交互的编辑器日常可以玩玩。 <a href="http://editor.thebookofshaders.com/SLWRZ/" target="_blank" rel="noopener">http://editor.thebookofshaders.com/SLWRZ/</a> (maybe需要科学上网). 。</p><h3 id="随机性"><a href="#随机性" class="headerlink" title="随机性"></a>随机性</h3><p>一般来说shader里高效的生成随机数，这个随机性一般来自对一个超高频的函数进行采样。创造一个超高频的函数很简单，首先需要有周期性，所以三角函数一般是需要的，你可以把一个sin，振幅给的非常大，然后取小数，这就是一般shader里随机数生成的常用做法，我自己尝试了直接用一个超高频的sin，效果也不错，但可能再结合其他函数还是会暴露周期性，所以可能有时候不适用。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">rand</span><span class="params">(<span class="keyword">float</span> n)</span></span>&#123;<span class="keyword">return</span> fract(<span class="built_in">sin</span>(n) * <span class="number">43758.5453123</span>);&#125;</span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">rand</span><span class="params">(<span class="keyword">float</span> n)</span></span>&#123;<span class="keyword">return</span> (<span class="built_in">sin</span>(n * <span class="number">1234567.0</span>));&#125;</span><br></pre></td></tr></table></figure><p>二维随机数: 和一维的一样，需要把二维降到一维，这里可以用一个点积。因为点积的结果，在xy两个轴分别看上去，其实线性的，另外一个维度就是截距的不同，所以可以直接用一维的方法，并不会在某个方向产生不均匀的问题（假设你一维的方法能够保证随机性）。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">rand</span><span class="params">(vec2 n)</span> </span>&#123; </span><br><span class="line">	<span class="keyword">return</span> fract(<span class="built_in">sin</span>(dot(n, vec2(<span class="number">12.9898</span>, <span class="number">4.1414</span>))) * <span class="number">43758.5453</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>有时候为了更好的质量，可以再乘一个dot过的sin在里边。</p><h3 id="简单噪声"><a href="#简单噪声" class="headerlink" title="简单噪声"></a>简单噪声</h3><p>噪声同时包含了随机性的连续性。纯粹的随机是完全离散的，除了概率毫无规律的，跳跃的，当我们试图在一个规整的，几何的形态上，引入随机性的因素，可以创造出有机的自然的形态。下面这个basic的noise，是在整数位上做随机，然后中间直接插值。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">noise</span><span class="params">(<span class="keyword">float</span> p)</span></span>&#123;</span><br><span class="line">	<span class="keyword">float</span> fl = <span class="built_in">floor</span>(p);</span><br><span class="line">    <span class="keyword">float</span> fc = fract(p);</span><br><span class="line">	<span class="keyword">return</span> mix(rand(fl), rand(fl + <span class="number">1.0</span>), smoothstep(<span class="number">0.</span>,<span class="number">1.</span>,fc));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">noise</span><span class="params">(vec2 n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">const</span> vec2 d = vec2(<span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">    vec2 b = <span class="built_in">floor</span>(n);</span><br><span class="line">    vec2 f = smoothstep(vec2(<span class="number">0.0</span>), vec2(<span class="number">1.0</span>), fract(n));</span><br><span class="line">	<span class="keyword">return</span> mix(mix(rand(b), rand(b + d.yx), f.x), </span><br><span class="line">               mix(rand(b + d.xy), rand(b + d.yy), f.x)</span><br><span class="line">               , f.y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">noise</span><span class="params">(vec2 p)</span></span>&#123;</span><br><span class="line">	vec2 ip = <span class="built_in">floor</span>(p);</span><br><span class="line">	vec2 u = fract(p);</span><br><span class="line">	u = u*u*(<span class="number">3.0</span><span class="number">-2.0</span>*u);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">float</span> res = mix(</span><br><span class="line">		mix(rand(ip),rand(ip+vec2(<span class="number">1.0</span>,<span class="number">0.0</span>)),u.x),</span><br><span class="line">		mix(rand(ip+vec2(<span class="number">0.0</span>,<span class="number">1.0</span>)),rand(ip+vec2(<span class="number">1.0</span>,<span class="number">1.0</span>)),u.x),u.y);</span><br><span class="line">	<span class="keyword">return</span> res*res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>一般这种simple value noise的patten是，floor你的变量，拿到离散的整数位，fract你的变量，拿到一个单位跨度的连续增长，在离散的整数位上做随机，然后用这个整数位间的连续量做插值，插值的效果，比如过渡的方法，通过影射插值连续量实现，比如smooth，比如上面第二个noise的多项式。</p><blockquote><p>value noise一般非常块状，为了消除这种块状的效果，在 1985 年 <a href="https://mrl.nyu.edu/~perlin/" target="_blank" rel="noopener">Ken Perlin</a> 开发了另一种 noise 算法 Gradient Noise。Ken 解决了如何插入随机的 gradients（梯度、渐变）而不是一个固定值。这些梯度值来自于一个二维的随机函数，返回一个方向（vec2 格式的向量），而不仅是一个值（float格式）。</p></blockquote><p>各种高级的noise可以参考 <a href="https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83" target="_blank" rel="noopener">https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83</a></p><h3 id="平移旋转缩放"><a href="#平移旋转缩放" class="headerlink" title="平移旋转缩放"></a>平移旋转缩放</h3><p>这个没有什么好说的，把matrix乘到归一化的coord上就可以, 比如旋转。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">mat2 <span class="title">rotate2d</span><span class="params">(<span class="keyword">float</span> _angle)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mat2(<span class="built_in">cos</span>(_angle),-<span class="built_in">sin</span>(_angle),</span><br><span class="line">                <span class="built_in">sin</span>(_angle),<span class="built_in">cos</span>(_angle));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vec2 st = gl_FragCoord.xy/u_resolution.xy;</span><br><span class="line">st = rotate2d( PI ) * st;</span><br></pre></td></tr></table></figure><h3 id="硬边缘和重复性"><a href="#硬边缘和重复性" class="headerlink" title="硬边缘和重复性"></a>硬边缘和重复性</h3><p>典型的重复例如平铺，可以通过放大，然后取小数，重新映射回1-0的技巧实现。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vec2 st = gl_FragCoord.xy/u_resolution;</span><br><span class="line">   vec3 color = vec3(<span class="number">0.0</span>);</span><br><span class="line"></span><br><span class="line">   st *= <span class="number">3.0</span>;      <span class="comment">// Scale up the space by 3</span></span><br><span class="line">   st = fract(st); <span class="comment">// Wrap arround 1.0</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// Now we have 3 spaces that goes from 0-1</span></span><br></pre></td></tr></table></figure><p>提取奇偶项或者整数倍项的做法：利用取余</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fract(x) === mod(x,<span class="number">1.0</span>) <span class="comment">// 事实上可以替代的</span></span><br><span class="line">mod(x,<span class="number">2.0</span>) &lt; <span class="number">1.0</span> ? <span class="number">0.</span> : <span class="number">1.</span> ; <span class="comment">//偶数项</span></span><br></pre></td></tr></table></figure><p>一般如果需要生成几何类型的patten，往往是利用step或者mod判断来做出分段，patten上的任何分段，分块之类的硬边缘，几乎都是shader里的条件判断产生的。如何设计出通用的shader函数，和组合的模式，来总结出一套patten的生成方法，似乎是有趣而充满挑战的事情。</p></div><div class="article-tags"></div></article><script>document.getElementById("loading-bar").style.width="60%"</script></main><footer id="footer" class="clearfix"><div>&copy; mikialex Theme by <a href="http://artifact.me/" target="_blank">Art Chen</a>.</div><div>Powered by <a href="https://hexo.io/" rel="external">Hexo</a>.</div></footer><script>document.getElementById("loading-bar").style.width="80%"</script><div class="overlay"></div></div><div class="site-sidebar"><div class="sidebar-switch clearfix" style="display:none"><a class="dark-btn active" data-toggle="toc"><span class="icon icon-list"></span> <span class="text">Index</span> </a><a class="dark-btn" data-toggle="bio"><span class="icon icon-person"></span> <span class="text">Bio</span></a></div><div class="site-toc" style="display:none"><div class="no-index">No Index</div></div><div class="site-bio show" style="display:block"><div class="about-me clearfix"><div class="avatar"><img src="/img/avatar.png"></div><div class="info"><a class="name dark-btn" href="/about">miki alex</a></div><div class="info"><span class="item desc"></span></div></div><div class="social clearfix"><a href="/atom.xml" class="feed" target="_blank" rel="external"><span class="icon icon-feed"></span> </a><a href="https://github.com/mikialex" class="github" target="_blank" rel="external"><span class="icon icon-github"></span></a></div></div><div class="shortcuts"><a href="#header" class="top window-nav dark-btn" id="go-top"><span class="icon icon-chevron-thin-up"></span> </a><a class="close dark-btn" id="sidebar-close"><span class="icon icon-close"></span> </a><a href="#footer" class="top window-nav dark-btn" id="go-bottom"><span class="icon icon-chevron-thin-down"></span></a></div></div><script type="text/javascript">var GOOGLE_CUSTOM_SEARCH_API_KEY="",GOOGLE_CUSTOM_SEARCH_ENGINE_ID="",ALGOLIA_API_KEY="",ALGOLIA_APP_ID="",ALGOLIA_INDEX_NAME="",AZURE_SERVICE_NAME="",AZURE_INDEX_NAME="",AZURE_QUERY_KEY="",BAIDU_API_ID="",SEARCH_SERVICE="google",universalSearchConfig={};"google"===SEARCH_SERVICE?universalSearchConfig={searchService:SEARCH_SERVICE,apiKey:GOOGLE_CUSTOM_SEARCH_API_KEY,engineId:GOOGLE_CUSTOM_SEARCH_ENGINE_ID,imagePath:"/img/"}:"algolia"===SEARCH_SERVICE?universalSearchConfig={searchService:SEARCH_SERVICE,apiKey:ALGOLIA_API_KEY,appId:ALGOLIA_APP_ID,indexName:ALGOLIA_INDEX_NAME,imagePath:"/img/"}:"azure"===SEARCH_SERVICE&&(universalSearchConfig={searchService:SEARCH_SERVICE,serviceName:AZURE_SERVICE_NAME,indexName:AZURE_INDEX_NAME,apiKey:AZURE_QUERY_KEY,imagePath:"/img/"})</script><script src="https://code.jquery.com/jquery-2.1.4.min.js"></script><script>window.jQuery||document.write('<script src="/js/jquery.js"><\/script>')</script><script src="/js/search.js"></script><script src="/js/app.js"></script><script>document.getElementById("loading-bar").style.width="100%"</script></body></html>