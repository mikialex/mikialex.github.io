<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>根据ANGLE 实现原理的 WebGL优化建议 | mikialex</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="本文来自 webGL insights 的第一章节阅读整理chrome 浏览器目前在使用份额上表现出统治性的地位，而 windows 则是最常用的个人桌面操作系统，所以 windows 平台下 chrome 的一些 webgl 的优化知识需要被重点关注。在windows平台下，chrome 和 firefox 的 webgl 后端支持是 ANGLE 。ANGLE 是 Google 发起的开源项目，"><meta property="og:type" content="article"><meta property="og:title" content="根据ANGLE 实现原理的 WebGL优化建议"><meta property="og:url" content="http://yoursite.com/2018/11/17/webgl-opti-guide/index.html"><meta property="og:site_name" content="mikialex"><meta property="og:description" content="本文来自 webGL insights 的第一章节阅读整理chrome 浏览器目前在使用份额上表现出统治性的地位，而 windows 则是最常用的个人桌面操作系统，所以 windows 平台下 chrome 的一些 webgl 的优化知识需要被重点关注。在windows平台下，chrome 和 firefox 的 webgl 后端支持是 ANGLE 。ANGLE 是 Google 发起的开源项目，"><meta property="og:locale" content="default"><meta property="og:image" content="http://yoursite.com/images/webgl-opti-guide/anglelayer.png"><meta property="og:updated_time" content="2020-08-23T07:00:50.631Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="根据ANGLE 实现原理的 WebGL优化建议"><meta name="twitter:description" content="本文来自 webGL insights 的第一章节阅读整理chrome 浏览器目前在使用份额上表现出统治性的地位，而 windows 则是最常用的个人桌面操作系统，所以 windows 平台下 chrome 的一些 webgl 的优化知识需要被重点关注。在windows平台下，chrome 和 firefox 的 webgl 后端支持是 ANGLE 。ANGLE 是 Google 发起的开源项目，"><meta name="twitter:image" content="http://yoursite.com/images/webgl-opti-guide/anglelayer.png"><link rel="icon" href="/favicon.png"><link href="https://fonts.googleapis.com/css?family=Crimson+Text:400,700|Inconsolata|Oswald" rel="stylesheet"><link rel="stylesheet" href="/icomoon/style.css"><link rel="stylesheet" href="/style.css"></head><body><div class="site-wrapper is_post_page"><div id="loading-bar-wrapper"><div id="loading-bar"></div></div><script>document.getElementById("loading-bar").style.width="20%"</script><header id="header" class="site-header clearfix"><a class="logo square clearfix" href="/"><span class="b">A</span> <span class="b">R</span> <span class="b">T</span> <span class="w">I</span> <span class="w">F</span> <span class="b">A</span> <span class="b">C</span> <span class="b">T</span> </a><a class="me square site-nav-switch clearfix"><span class="b"><span class="icon icon-menu"></span></span></a></header><script>document.getElementById("loading-bar").style.width="40%"</script><main id="main" class="clearfix"><article id="post-webgl-opti-guide" class="article white-box article-type-post" itemscope itemprop="blogPost"><header class="article-header"><h1 class="article-title" itemprop="name">根据ANGLE 实现原理的 WebGL优化建议</h1><div class="article-meta">Posted on <time class="article-time" datetime="2018-11-16T16:00:00.000Z" itemprop="datePublished">Nov 17, 2018</time></div></header><div class="article-entry" itemprop="articleBody"><p><img src="/images/webgl-opti-guide/anglelayer.png" style="width:100%;max-width:300px"></p><blockquote><p>本文来自 webGL insights 的第一章节阅读整理</p></blockquote><p>chrome 浏览器目前在使用份额上表现出统治性的地位，而 windows 则是最常用的个人桌面操作系统，所以 windows 平台下 chrome 的一些 webgl 的优化知识需要被重点关注。在windows平台下，chrome 和 firefox 的 webgl 后端支持是 ANGLE 。ANGLE 是 Google 发起的开源项目，最初是为了使用 D3D 9 来实现 OpenGL es 2.0，而 WebGL 正是基于前者。当然， chrome不仅把 ANGLE 作为 webGL 的后端，还用来支持整个浏览器的渲染加速。现在 ANGLE 不仅拥有 D3D 9的后端， 还有 D3D 11 以及 OpenGL的后端，可以说是将 opengl es 的 API 移植到桌面的首选支持。</p><p>ANGLE 会将 webgl 使用的 glsl 翻译成 d3d 的 hlsl， 并且运行时验证 gl 的调用是否合法。所有的基于状态机的光栅化 API，都无非是设置状态，和执行渲染命令。ANGLE 会将等价的状态设置和等价的渲染调用进行翻译，直接使用底层 API，所以只有很小的性能损失。ANGLE 并不是一个模拟器。</p><p>因为 OpenGL 和 D3D 在本身的设计和支持上存在差异，所以一些 OpenGL 原先轻而易举可以做的事情，不一定能很好的映射到对应的高效的 D3D 实现， 所以在 ANGLE 的基础上，我们可以总结出一些最佳实践。归纳如下。</p><h5 id="避免使用LINE-LOOP-和-TRIANGLE-FAN"><a href="#避免使用LINE-LOOP-和-TRIANGLE-FAN" class="headerlink" title="避免使用LINE_LOOP 和 TRIANGLE_FAN"></a>避免使用LINE_LOOP 和 TRIANGLE_FAN</h5><p>D3D 里没有 LINE_LOOP 这种 DrawMode，TRIANGLE_FAN 在 D3D 11 里不被支持。ANGLE 需要重写 index buffer来支持。</p><h5 id="总是使用新的纹理，而不是对旧的做出修改"><a href="#总是使用新的纹理，而不是对旧的做出修改" class="headerlink" title="总是使用新的纹理，而不是对旧的做出修改"></a>总是使用新的纹理，而不是对旧的做出修改</h5><p>D3D 的纹理 API 需要在创建纹理的时候，就确定所有参数。而为了支持纹理属性的修改，ANGLE 需要维护多份纹理拷贝，并且在绘制时产生额外的延迟。</p><h5 id="在剪切和蒙板开启时，不要-执行Clear操作"><a href="#在剪切和蒙板开启时，不要-执行Clear操作" class="headerlink" title="在剪切和蒙板开启时，不要 执行Clear操作"></a>在剪切和蒙板开启时，不要 执行Clear操作</h5><p>D3D 的 clear 操作会无视剪切和蒙板，而 GL clear 时会考虑剪切和蒙板。 ANGLE 需要绘制一个四边形来支持剪切效果，并且产生额外的状态切换成本。</p><h5 id="使用多边形来实现带宽度的线"><a href="#使用多边形来实现带宽度的线" class="headerlink" title="使用多边形来实现带宽度的线"></a>使用多边形来实现带宽度的线</h5><p>chrome 的 webgl 线宽不被支持时一个很经典的事情，甚至在汇报 chrome bug 的网站，chrome 的开发者直接回应说，“线的宽度是个没有意义的概念” 这个事情想想真的比较搞笑。不过从数学的意义上讲，线的宽度的确还真的没有什么意义。</p><p>任何现代图形硬件上，带宽度的线都不是原生的基本图元。所以需要模拟实现，这个模拟，要么应用层来做，要么驱动层来做。带宽度的线其实很复杂，joint style各种各样，今天支持了这种，明天还会有人问为什么不支持那一种，所以其实我也是认同 chrome 的做法的，这个事情就应该放在应用层实现。</p><h5 id="在顶点-Buffer-中，避免使用三通道的-Uint8Array／Uint16Array"><a href="#在顶点-Buffer-中，避免使用三通道的-Uint8Array／Uint16Array" class="headerlink" title="在顶点 Buffer 中，避免使用三通道的 Uint8Array／Uint16Array"></a>在顶点 Buffer 中，避免使用三通道的 Uint8Array／Uint16Array</h5><p>主要是 D3D 底层对三通道的数据支持有限， ANGLE 会自己转成四通道的数据。如果是 dynamic 的， 甚至每次画之前都会转换。</p><h5 id="在索引-Buffer-中，-避免使用-Uint8Array"><a href="#在索引-Buffer-中，-避免使用-Uint8Array" class="headerlink" title="在索引 Buffer 中， 避免使用 Uint8Array"></a>在索引 Buffer 中， 避免使用 Uint8Array</h5><p>D3D 不支持在索引 Buffer 中使用 8位的数据。ANGLE 会转化回 16 位格式。</p><h5 id="避免在-16位索引-Buffer-中，使用-0xFFFF-值"><a href="#避免在-16位索引-Buffer-中，使用-0xFFFF-值" class="headerlink" title="避免在 16位索引 Buffer 中，使用 0xFFFF 值"></a>避免在 16位索引 Buffer 中，使用 0xFFFF 值</h5><p>在 D3D 11 中， 这个值具有特殊意义，代表三角形 strip-cut， 当是，这个是个 bug 被发现才被改正的。 ANGLE 一旦发现有这个值，会直接转化使用 32 位的数据。</p><h5 id="正确使用-buffer-标记"><a href="#正确使用-buffer-标记" class="headerlink" title="正确使用 buffer 标记"></a>正确使用 buffer 标记</h5><p>需要 STATIC_DRAW , 就指明。不然，ANGLE 会反复在内部执行数据转换。</p><h5 id="总是指明片元着色器浮点精度"><a href="#总是指明片元着色器浮点精度" class="headerlink" title="总是指明片元着色器浮点精度"></a>总是指明片元着色器浮点精度</h5><p>之前据说写不写无所谓，后来强制必须要写了。。</p><h5 id="不要使用-Rendering-Feedback-Loops"><a href="#不要使用-Rendering-Feedback-Loops" class="headerlink" title="不要使用 Rendering Feedback Loops"></a>不要使用 Rendering Feedback Loops</h5><p>Rendering Feedback Loops 是指同时在同一个纹理上进行渲染和采样，／／我都不知道可以这样？？ 总之 只有D3D 9 支持，现在一定都不支持。</p></div><div class="article-tags"></div></article><script>document.getElementById("loading-bar").style.width="60%"</script></main><footer id="footer" class="clearfix"><div>&copy; mikialex Theme by <a href="http://artifact.me/" target="_blank">Art Chen</a>.</div><div>Powered by <a href="https://hexo.io/" rel="external">Hexo</a>.</div></footer><script>document.getElementById("loading-bar").style.width="80%"</script><div class="overlay"></div></div><div class="site-sidebar"><div class="sidebar-switch clearfix" style="display:none"><a class="dark-btn active" data-toggle="toc"><span class="icon icon-list"></span> <span class="text">Index</span> </a><a class="dark-btn" data-toggle="bio"><span class="icon icon-person"></span> <span class="text">Bio</span></a></div><div class="site-toc" style="display:none"><div class="no-index">No Index</div></div><div class="site-bio show" style="display:block"><div class="about-me clearfix"><div class="avatar"><img src="/img/avatar.png"></div><div class="info"><a class="name dark-btn" href="/about">miki alex</a></div><div class="info"><span class="item desc"></span></div></div><div class="social clearfix"><a href="/atom.xml" class="feed" target="_blank" rel="external"><span class="icon icon-feed"></span> </a><a href="https://github.com/mikialex" class="github" target="_blank" rel="external"><span class="icon icon-github"></span></a></div></div><div class="shortcuts"><a href="#header" class="top window-nav dark-btn" id="go-top"><span class="icon icon-chevron-thin-up"></span> </a><a class="close dark-btn" id="sidebar-close"><span class="icon icon-close"></span> </a><a href="#footer" class="top window-nav dark-btn" id="go-bottom"><span class="icon icon-chevron-thin-down"></span></a></div></div><script type="text/javascript">var GOOGLE_CUSTOM_SEARCH_API_KEY="",GOOGLE_CUSTOM_SEARCH_ENGINE_ID="",ALGOLIA_API_KEY="",ALGOLIA_APP_ID="",ALGOLIA_INDEX_NAME="",AZURE_SERVICE_NAME="",AZURE_INDEX_NAME="",AZURE_QUERY_KEY="",BAIDU_API_ID="",SEARCH_SERVICE="google",universalSearchConfig={};"google"===SEARCH_SERVICE?universalSearchConfig={searchService:SEARCH_SERVICE,apiKey:GOOGLE_CUSTOM_SEARCH_API_KEY,engineId:GOOGLE_CUSTOM_SEARCH_ENGINE_ID,imagePath:"/img/"}:"algolia"===SEARCH_SERVICE?universalSearchConfig={searchService:SEARCH_SERVICE,apiKey:ALGOLIA_API_KEY,appId:ALGOLIA_APP_ID,indexName:ALGOLIA_INDEX_NAME,imagePath:"/img/"}:"azure"===SEARCH_SERVICE&&(universalSearchConfig={searchService:SEARCH_SERVICE,serviceName:AZURE_SERVICE_NAME,indexName:AZURE_INDEX_NAME,apiKey:AZURE_QUERY_KEY,imagePath:"/img/"})</script><script src="https://code.jquery.com/jquery-2.1.4.min.js"></script><script>window.jQuery||document.write('<script src="/js/jquery.js"><\/script>')</script><script src="/js/search.js"></script><script src="/js/app.js"></script><script>document.getElementById("loading-bar").style.width="100%"</script></body></html>